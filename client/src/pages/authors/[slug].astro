---
import { Image, Picture } from "astro:assets";
import fetchApi from "../../lib/strapi";
import BaseLayout from "../../layouts/BaseLayout.astro";
import RandomAuthors from "../../components/RandomAuthors.astro";

export async function getStaticPaths() {
    // const books = await fetchApi({
    //     endpoint: "books",
    //     wrappedByKey: "data",
    //     query: { populate: "image" },
    // });

    const authors = await fetchApi({
        endpoint: "authors",
        wrappedByKey: "data",
        query: { populate: ["books", "image"] },
    });

    const paths = authors.map((author) => ({
        params: { slug: author.slug },
        props: {
            author,
        },
    }));

    return paths;
}

const { author } = Astro.props;
console.log(author);
---

<BaseLayout>
    <h2>{author.name}</h2>
    <Image
        src={`${import.meta.env.STRAPI_URL}${author.image.url}`}
        alt="Book image"
        width="300"
        height="400"
        widths={[250, 350, 500, 750]}
        format="avif"
        sizes="(min-width: 2960px) calc(12.5vw - 118px), (min-width: 2600px) calc(5vw + 121px), (min-width: 2240px) calc(5.29vw + 131px), (min-width: 1900px) calc(5vw + 157px), (min-width: 1540px) calc(4.71vw + 180px), (min-width: 1160px) calc(3.33vw + 217px), (min-width: 1120px) calc(325vw - 3455px), (min-width: 760px) calc(3.53vw + 229px), (min-width: 540px) calc(42vw - 43px), calc(8.18vw + 225px)"
    />
    <p>Date of birth: {author.born}</p>
    <h3>About</h3>
    <p>{author.description}</p>
    <h3>Books I own</h3>
    <ul>
        {
            author.books.map((book) => (
                <li key={book.slug}>
                    <a href={`/books/${book.slug}`}>
                        <h4>{book.title}</h4>
                        {book.image && (
                            <Image
                                src={`${import.meta.env.STRAPI_URL}${book.image.url}`}
                                alt="Book image"
                                width="300"
                                height="400"
                                widths={[250, 350, 500, 750]}
                                format="avif"
                                sizes="(min-width: 2960px) calc(12.5vw - 118px), (min-width: 2600px) calc(5vw + 121px), (min-width: 2240px) calc(5.29vw + 131px), (min-width: 1900px) calc(5vw + 157px), (min-width: 1540px) calc(4.71vw + 180px), (min-width: 1160px) calc(3.33vw + 217px), (min-width: 1120px) calc(325vw - 3455px), (min-width: 760px) calc(3.53vw + 229px), (min-width: 540px) calc(42vw - 43px), calc(8.18vw + 225px)"
                            />
                        )}
                    </a>
                </li>
            ))
        }
    </ul>
    <RandomAuthors></RandomAuthors>
</BaseLayout>
