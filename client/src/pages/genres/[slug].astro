---
import { Image, Picture } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";
import fetchApi from "../../lib/strapi";

export async function getStaticPaths() {
    const genres = await fetchApi({
        endpoint: "genres",
        wrappedByKey: "data",
        query: { populate: "books" },
    });

    const paths = genres.map((genre) => ({
        params: { slug: genre.slug },
        props: {
            genre,
        },
    }));

    return paths;
}

const { genre } = Astro.props;
---

<BaseLayout>
    <h2>{genre.title}</h2>
    <p>What is {genre.title} in books?</p>
    <p>{genre.description}</p>
    <ul>
        {
            genre.books.map((book) => (
                <li key={book.slug}>
                    <a href={`/books/${book.slug}`}>
                        <h4>{book.title}</h4>
                        {book.image && (
                            <img
                                src={`${import.meta.env.STRAPI_URL}${book.image.url}`}
                                alt={book.title}
                                width="150"
                                height="200"
                            />
                        )}
                    </a>
                </li>
            ))
        }
    </ul>
</BaseLayout>
